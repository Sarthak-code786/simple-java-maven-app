pipeline {
  agent any
  environment {
    VERSION = "1.0.${BUILD_NUMBER}"
    ARTIFACT_NAME = "student-portal-${VERSION}.jar"
    EMAIL_RECIPIENTS = 'your-email@example.com'
  }
  stages {
    stage('Checkout') {
      steps { git "https://github.com/YOUR_USERNAME/simple-java-maven-app.git" }
    }
    stage('Build') {
      steps { sh 'mvn clean package -DskipTests' }
    }
    stage('Test') {
      steps { sh 'mvn test' }
    }
    stage('Archive') {
      steps {
        archiveArtifacts artifacts: 'target/*.jar', fingerprint: true
        sh "cp target/*.jar target/${ARTIFACT_NAME}"
      }
    }
    stage('Tag Version') {
      steps {
        sh """
          git config user.name 'jenkins'
          git config user.email 'jenkins@example.com'
          git tag v${VERSION}
          git push origin v${VERSION}
        """
      }
    }
  }
  post {
    success {
      mail to: EMAIL_RECIPIENTS,
           subject: "✅ Build #${BUILD_NUMBER} Succeeded",
           body: "Build succeeded. Artifact: ${ARTIFACT_NAME}"
    }
    failure {
      mail to: EMAIL_RECIPIENTS,
           subject: "❌ Build #${BUILD_NUMBER} Failed",
           body: "Build failed. Please check Jenkins for errors."
    }
  }
}
